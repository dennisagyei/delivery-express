<!DOCTYPE html>
<html>
    <html lang="en" ng-app="app" ng-controller="MainCtrl">

        <!-- /.website title -->
        <title>potomanto | Home</title>
        <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">

        <meta charset="UTF-8" />
        <!-- CSS Files -->
        <!--<link href="css/bootstrap.min.css" rel="stylesheet" media="screen">-->
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
        <link href="css/font-awesome.min.css" rel="stylesheet">
        <link href="fonts/icon-7-stroke/css/pe-icon-7-stroke.css" rel="stylesheet">
        <link href="css/animate.css" rel="stylesheet" media="screen">
        <link href="css/owl.theme.css" rel="stylesheet">
        <link href="css/owl.carousel.css" rel="stylesheet">
        <link href="css/bootstrap-datetimepicker.min.css" rel="stylesheet">
        <link href="css/css-index-blue.css" rel="stylesheet" media="screen"> 
        <link href="css/iziToast.min.css" rel="stylesheet">
        <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/angularjs/1.6.6/angular.min.js"></script>
        <script type="text/javascript" src="js/angular-resource.min.js"></script>
        


        <!-- Google Fonts -->
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:100,300,400,700,900,100italic,300italic,400italic,700italic,900italic" />

    </head>

    <body data-spy="scroll" data-target="#navbar-scroll">

        <!-- /.preloader -->
        <div id="preloader"></div>
        <div id="top"></div>

        <!-- /.parallax full screen background image -->
        <div class="fullscreen landing parallax " style="background-image:url('images/bg-baner-ariportcity.jpg');" data-img-width="2000" data-img-height="1333" data-diff="100">

            <div class="overlay">
                <div class="container">
                    <div class="col-md-10 col-md-offset-1 text-center">

                        <!-- /.logo -->
                        <div class="logo wow fadeInDown" style="margin-top: 50px">
                             
                        </div>

                        <!-- /.main title -->
                        <h2 class="wow fadeInUp" style="margin-bottom: 50px">
                            Welcome : {{ login_user.facebook.name }}
                        </h2>

                    </div>
                </div>
            </div>
        </div>

       
            <!-- NAVIGATION -->
            <div id="menu">
                <nav class="navbar-wrapper navbar-default" role="navigation">
                    <div class="container">
                        <div class="navbar-header">
                            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-backyard">
                                <span class="sr-only">Toggle navigation</span>
                                <span class="icon-bar"></span>
                                <span class="icon-bar"></span>
                                <span class="icon-bar"></span>
                            </button>
                            <a class="navbar-brand site-name" href="#top">
                                <span class="wow fadeInLeft" style="display:inline-block"><a href="" class="btn-logo-w"><i class="fa fa-delicious"></i> potomanto</a></span>
                            </a>
                        </div>

                        <div id="navbar-scroll" class="collapse navbar-collapse navbar-backyard navbar-right">
                            <ul class="nav navbar-nav">
                                
                                
                                <li class="ymm-sw">
                                     <a class="dropdown-toggle" data-toggle="dropdown" data-hover="dropdown" data-delay="200" href="/home">Menu <b class="caret"></b> </a>
                                     <ul class="dropdown-menu navbar-nav">
                                        <li><a href="/bookings">My Bookings</a></li>
                                        <li><a href="/payments">Payments</a></li>
                                        <li><a href="/profile">Profile</a></li> 
                                        
                                        <li><a href="/logout">Sign out</a></li> 
                                           
                                     </ul>
                                </li>  
                                
                            </ul>
                        </div>
                    </div>
                </nav>
            </div>

         <div id="map-section" class="container-fluid">
            <div class="row">
               <div class="col-md-3" style="padding-top: 5px;">
                  <form role="form" name="Form" ng-submit="confirmItem(booking)">
                    <div class="panel panel-info" style="border: 1px solid #0aabe1;">
                      <div class="panel-heading"  style="background: #0aabe1; font-weight: bold; color: white">Routes</div>
                      <div class="panel-body">
                        <div class="form-group">
                          <input class="form-control" name="picking_up" id="picking_up" ng-model="booking.picking_up" type="text" data-toggle="popover"  data-placement="top" data-trigger="focus" data-content="Please enter your pickup location" placeholder="Enter Pick-up location" required>
                        </div> 
                              
                        <div class="form-group">
                          <input class="form-control" name="dropping_off" id="dropping_off" ng-model="booking.dropping_off" type="text" data-toggle="popover" data-placement="bottom" data-trigger="focus" title="Required" data-content="Please enter your drop-off location" placeholder="Enter drop-off location" required>
                        </div>
                      </div>
                    </div>
                    
                    <div class="panel panel-default">
                      <div class="panel-heading"> Select Courier/Pick-up Date</div>
                      <div class="panel-body">
                        <div class="form-group">
                          <select class="form-control" name="selectcourier" id="selectcourier"  ng-model="booking.courier" required>
                            <option ng-repeat="x in couriers" value="{{x._id}}">{{x.name}}</option>
                          </select>
                        </div>
                        <div class="form-group">
                          <input class="form-control" name="pick_up_date" id="pick_up_date" ng-model="booking.pick_up_date" type="date" placeholder="Enter Pick-up date" required>
                        </div> 
                        
                      </div>
                    </div>
                    
                    <div class="text-center">
                      <button type="submit" class="btn btn-primary">MAKE A REQUEST</button>
                    </div>

                  </form>  
               </div>
               <div class="col-md-9">
                  <div id="map_canvas" class="map_div"></div>
               </div>
            </div>
        </div>
              
        <!--Modal Dialog Form -->
        <div id="confirmModal" class="modal fade" tabindex="-1" role="dialog">
          <div class="modal-dialog modal-lg" role="document">
            <div class="modal-content">
              <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                <h4 class="modal-title">#0000{{invoice_no}}: Request Confirmation</h4>
              </div>
              <div class="modal-body">
                  <div class="row">
                      <div class="col-md-4 col-lg-4 " align="center"> 
                           <div class="panel status panel-info" style="border: 1px solid blue; border-radius: 4px;">
                                <div class="panel-heading">
                                    <h1 class="panel-title text-center">Ghs 34.0</h1>
                                </div>
                                <div class="panel-body text-center">                        
                                    <strong>Total Charge</strong>
                                </div>
                            </div>
                      </div>
                      
                      <div class=" col-md-8 col-lg-8 "> 
                        <table class="table table-user-information">
                          <tbody>
                            <tr>
                              <td></i>Pick-up Location:</td>
                              <td>{{ start_address }}</td>
                            </tr>
                            <tr>
                              <td>Drop-off Location:</td>
                               <td>{{ end_address }}</td>
                            </tr>
                            <tr>
                              <td>Pick-up Date:</td>
                              <td>06/23/2013</td>
                            </tr>
                            <tr>
                              <td>Courier</td>
                              <td>{{ courier }}</td>
                            </tr>
                           
                              <td>Add a Note</td>
                              <td><textarea class="form-control" rows="4" placeholder="Notes"></textarea></td>
                                 
                            </tr>
                           
                          </tbody>
                        </table>
                        
                      </div>
                    </div>
              </div>
              <div class="modal-footer">
                <button type="button" class="btn btn-labeled btn-danger" data-dismiss="modal"><span class="btn-label"><i class="glyphicon glyphicon-remove"></i></span>Cancel</button>
                <button type="button" class="btn btn-labeled btn-success"><span class="btn-label"><i class="glyphicon glyphicon-ok"></i></span>Accept</button>
              </div>
            </div><!-- /.modal-content -->
          </div><!-- /.modal-dialog -->
        </div><!-- /.modal -->
       
            


        <!-- /.javascript files -->
        <script type="text/javascript" src="js/app.js"></script>
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/2.0.3/socket.io.slim.js"></script>
        <script src="js/bootstrap-datetimepicker.min.js"></script>
        <script src="js/custom.js"></script>
        <script src="js/jquery.sticky.js"></script>
        <script src="js/wow.min.js"></script>
        <script src="js/owl.carousel.min.js"></script>
        <script src="js/bootstrap-hover-dropdown.js"></script>
        <script src="js/booking.js"></script>
        <script src="js/jquery.validate.min.js"></script>
        <script src="js/iziToast.min.js" type="text/javascript"></script>
        <script>
              
              //Enable pop overs
             
              
              new WOW().init();
              //var socket = io();
              
            

              var map,infoWindow;
              var geocoder;
              var markerA,markerB;
              var inputA, inputB;
              var autocompleteA,autocompleteB;
              var directionsService,directionsDisplay;
              var markerArray = [];
              
              function initMap() {
                  
                var mapOptions = {
                    center: {lat: 5.5885497, lng: -0.185424},
                    zoom: 6,
                    zoomControl: true,
                    mapTypeControl: false,
                    styles: styles['silverr'] //or 'night'
                };
                
                map = new google.maps.Map(document.getElementById('map_canvas'), mapOptions);
                
                directionsService = new google.maps.DirectionsService();
                directionsDisplay = new google.maps.DirectionsRenderer({
                  draggable: true,
                  map: map
                });
        
                directionsDisplay.addListener('directions_changed', function() {
                  computeTotalDistance(directionsDisplay.getDirections());
                  
                });
                //Define Markers
                markerA = new google.maps.Marker({
                    map: map,
                    label : 'A',
                    draggable: true,
                    title: 'Drag to set Pickup Location'
                  });
                
                markerB = new google.maps.Marker({
                    map: map,
                    label : 'B',
                    draggable: true,
                    title: 'Drag to set drop-off Location'
                  });
                
                inputA= document.getElementById('picking_up');
                inputB= document.getElementById('dropping_off');
                
                var AutocompleteOptions = {
                  componentRestrictions: {country: 'gh'}
                 };

                var autocompleteA = new google.maps.places.Autocomplete(inputA,AutocompleteOptions);
                    autocompleteA.bindTo('bounds', map);

                var autocompleteB = new google.maps.places.Autocomplete(inputB,AutocompleteOptions);
                    autocompleteB.bindTo('bounds', map);
                
                google.maps.event.addListener(autocompleteA, 'place_changed', function() {
                    
                    var place = autocompleteA.getPlace();
                    if (!place.geometry) {
                      return;
                    }
                
                    // Set the position of the marker using the place ID and location.
                    markerA.setPlace(/** @type {!google.maps.Place} */ ({
                      placeId: place.place_id,
                      location: place.geometry.location
                    }));
                    markerA.setVisible(true);
                
                });
                
                google.maps.event.addListener(autocompleteB, 'place_changed', function() {
                    
                    var place = autocompleteB.getPlace();
                    if (!place.geometry) {
                      return;
                    }
                
                    // Set the position of the marker using the place ID and location.
                    markerB.setPlace(/** @type {!google.maps.Place} */ ({
                      placeId: place.place_id,
                      location: place.geometry.location
                    }));
                    markerB.setVisible(true);
                    
                    map.setZoom(11);
                    
                    displayRoute(inputA.value,inputB.value);
                });

                infoWindow = new google.maps.InfoWindow;
                
                // auto set location geolocation.
                if (navigator.geolocation) {
                  navigator.geolocation.getCurrentPosition(function(position) {
                    var pos = {
                      lat: position.coords.latitude,
                      lng: position.coords.longitude
                    };
        
                    map.setCenter(pos);
                  }, function() {
                    handleLocationError(true, infoWindow, map.getCenter());
                  });
                } else {
                  // Browser doesn't support Geolocation
                  handleLocationError(false, infoWindow, map.getCenter());
                }
                
                
                   
                 //codeAddress();
              }
              
              function apply_autocomplete(input) {

                    var options = {
                        types: ['geocode']
                    };
                    var autocomplete = new google.maps.places.Autocomplete(input,options);
                    autocomplete.bindTo('bounds', map);
              }
              
              function handleLocationError(browserHasGeolocation, infoWindow, pos) {
                infoWindow.setPosition(pos);
                infoWindow.setContent(browserHasGeolocation ?
                                      'Error: The Geolocation service failed.' :
                                      'Error: Your browser doesn\'t support geolocation.');
                infoWindow.open(map);
              }
              
              
              function displayRoute(origin_add,destination_add)
              {
                  // Set destination, origin and travel mode.
                    var request = {
                      destination: destination_add,
                      origin: origin_add,
                      optimizeWaypoints: true,
                      travelMode: 'DRIVING'
                    };
            
                    // Pass the directions request to the directions service.
                    directionsService.route(request, function(response, status) {
                      if (status == 'OK') {
                        // Display the route on the map.
                        //directionsDisplay.setDirections(response);
                        directionsDisplay.setMap(map);
                        directionsDisplay.setDirections(response);
                        
                        deleteMarkers();
                      }else {
                        console.log('Directions request failed due to ' + status);
                      } 
                    });
              }
              
              function computeTotalDistance(result) {
                var total = 0;
                var myroute = result.routes[0];
                for (var i = 0; i < myroute.legs.length; i++) {
                  total += myroute.legs[i].distance.value;
                  
                 var strA= geocodePosition(myroute.legs[i].start_location.lat()+ ',' + myroute.legs[i].start_location.lng());
                  //geocodePosition('5.603042299999999,-0.17568630000005214');
                  console.log(myroute.legs[i].start_location.lat()+ ',' + myroute.legs[i].start_location.lng());
                }
                total = total / 1000;
                console.log('computeTotalDistance:'+ total + ' km');
              }
              
              function deleteMarkers() {
                markerA.setMap(null);
                markerB.setMap(null);
                //markers = [];
              }
              
              function getLocation() {
            	if (navigator.geolocation) {
            		navigator.geolocation.getCurrentPosition(showPosition, hidePosition);
            	}else{ 
            		console.log("Geolocation is not supported by this browser. Now we trying to get your location through your IP address.");
            		ipPosition();
            	}
              }
              function showPosition(position) {
            	pos = {
            		lat: parseFloat(position.coords.latitude),
            		lng: parseFloat(position.coords.longitude)
            	};
              } 
              function hidePosition(position) {
              	console.log('User denied the access of the position. Now we trying to get your location through your IP address.');
              	ipPosition();
              }
              
              function ipPosition(){
            	$.get("http://ipinfo.io", function (response) {
            		var loc = response.loc.split(',');
            		pos = {
            			lat: parseFloat(loc[0]),
            			lng: parseFloat(loc[1])
            		};
            	}, "jsonp");
              }
              
              function codeAddress(strAddress) //convert Address to LatLong 
              {
                geocoder = new google.maps.Geocoder();
                
                geocoder.geocode( { 'address': strAddress}, function(results, status) {
                  if (status == google.maps.GeocoderStatus.OK) {
                      return results[0].geometry.location;
                  } else {
                      console.log('codeAddress was not successful for the following reason: ' + status);
                  }
                });
              }
            
            function geocodePosition(inputlatlng) //convert LatLng to Address
            { 
              var geocoder = new google.maps.Geocoder();
              
              var latlngStr = inputlatlng.split(',', 2);
              
             
              var latlng = {lat: parseFloat(latlngStr[0]), lng: parseFloat(latlngStr[1])};
              
               //console.log(latlng);
              
              geocoder.geocode({'location': latlng}, function(results, status) {
                if (status == google.maps.GeocoderStatus.OK) {
                  if (results[1]) {
                    return results[1].formatted_address;
                  } else {
                    console.log('GeocodePosition No results found');
                  }
                } else {
                  console.log('geocodePosition failed due to: ' + status);
                }
              });
              
              
            }
            
           
            
    var styles = {
        default: null,
        silver: [
          {
            elementType: 'geometry',
            stylers: [{color: '#f5f5f5'}]
          },
          {
            elementType: 'labels.icon',
            stylers: [{visibility: 'off'}]
          },
          {
            elementType: 'labels.text.fill',
            stylers: [{color: '#616161'}]
          },
          {
            elementType: 'labels.text.stroke',
            stylers: [{color: '#f5f5f5'}]
          },
          {
            featureType: 'administrative.land_parcel',
            elementType: 'labels.text.fill',
            stylers: [{color: '#bdbdbd'}]
          },
          {
            featureType: 'poi',
            elementType: 'geometry',
            stylers: [{color: '#eeeeee'}]
          },
          {
            featureType: 'poi',
            elementType: 'labels.text.fill',
            stylers: [{color: '#757575'}]
          },
          {
            featureType: 'poi.park',
            elementType: 'geometry',
            stylers: [{color: '#e5e5e5'}]
          },
          {
            featureType: 'poi.park',
            elementType: 'labels.text.fill',
            stylers: [{color: '#9e9e9e'}]
          },
          {
            featureType: 'road',
            elementType: 'geometry',
            stylers: [{color: '#ffffff'}]
          },
          {
            featureType: 'road.arterial',
            elementType: 'labels.text.fill',
            stylers: [{color: '#757575'}]
          },
          {
            featureType: 'road.highway',
            elementType: 'geometry',
            stylers: [{color: '#dadada'}]
          },
          {
            featureType: 'road.highway',
            elementType: 'labels.text.fill',
            stylers: [{color: '#616161'}]
          },
          {
            featureType: 'road.local',
            elementType: 'labels.text.fill',
            stylers: [{color: '#9e9e9e'}]
          },
          {
            featureType: 'transit.line',
            elementType: 'geometry',
            stylers: [{color: '#e5e5e5'}]
          },
          {
            featureType: 'transit.station',
            elementType: 'geometry',
            stylers: [{color: '#eeeeee'}]
          },
          {
            featureType: 'water',
            elementType: 'geometry',
            stylers: [{color: '#c9c9c9'}]
          },
          {
            featureType: 'water',
            elementType: 'labels.text.fill',
            stylers: [{color: '#9e9e9e'}]
          }
        ],

        night: [
          {elementType: 'geometry', stylers: [{color: '#242f3e'}]},
          {elementType: 'labels.text.stroke', stylers: [{color: '#242f3e'}]},
          {elementType: 'labels.text.fill', stylers: [{color: '#746855'}]},
          {
            featureType: 'administrative.locality',
            elementType: 'labels.text.fill',
            stylers: [{color: '#d59563'}]
          },
          {
            featureType: 'poi',
            elementType: 'labels.text.fill',
            stylers: [{color: '#d59563'}]
          },
          {
            featureType: 'poi.park',
            elementType: 'geometry',
            stylers: [{color: '#263c3f'}]
          },
          {
            featureType: 'poi.park',
            elementType: 'labels.text.fill',
            stylers: [{color: '#6b9a76'}]
          },
          {
            featureType: 'road',
            elementType: 'geometry',
            stylers: [{color: '#38414e'}]
          },
          {
            featureType: 'road',
            elementType: 'geometry.stroke',
            stylers: [{color: '#212a37'}]
          },
          {
            featureType: 'road',
            elementType: 'labels.text.fill',
            stylers: [{color: '#9ca5b3'}]
          },
          {
            featureType: 'road.highway',
            elementType: 'geometry',
            stylers: [{color: '#746855'}]
          },
          {
            featureType: 'road.highway',
            elementType: 'geometry.stroke',
            stylers: [{color: '#1f2835'}]
          },
          {
            featureType: 'road.highway',
            elementType: 'labels.text.fill',
            stylers: [{color: '#f3d19c'}]
          },
          {
            featureType: 'transit',
            elementType: 'geometry',
            stylers: [{color: '#2f3948'}]
          },
          {
            featureType: 'transit.station',
            elementType: 'labels.text.fill',
            stylers: [{color: '#d59563'}]
          },
          {
            featureType: 'water',
            elementType: 'geometry',
            stylers: [{color: '#17263c'}]
          },
          {
            featureType: 'water',
            elementType: 'labels.text.fill',
            stylers: [{color: '#515c6d'}]
          },
          {
            featureType: 'water',
            elementType: 'labels.text.stroke',
            stylers: [{color: '#17263c'}]
          }
        ],

        
        hiding: [
          {
            featureType: 'poi.business',
            stylers: [{visibility: 'off'}]
          },
          {
            featureType: 'transit',
            elementType: 'labels.icon',
            stylers: [{visibility: 'off'}]
          }
        ]
      };
        </script>
        <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyC9H_SZmYKPM0TXnnnHxcRPMJyYjf00rvs&libraries=places"></script>
        
    </body>
</html>