<!DOCTYPE html>
<html>
    <head>

        <!-- /.website title -->
        <title>potomanto | Home</title>
        <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">

        <meta charset="UTF-8" />
        <!-- CSS Files -->
        <link href="css/bootstrap.min.css" rel="stylesheet" media="screen">
        <link href="css/font-awesome.min.css" rel="stylesheet">
        <link href="fonts/icon-7-stroke/css/pe-icon-7-stroke.css" rel="stylesheet">
        <link href="css/animate.css" rel="stylesheet" media="screen">
        <link href="css/owl.theme.css" rel="stylesheet">
        <link href="css/owl.carousel.css" rel="stylesheet">
        <link href="css/bootstrap-datetimepicker.min.css" rel="stylesheet">
        <link href="css/css-index-blue.css" rel="stylesheet" media="screen"> 

        <!-- Google Fonts -->
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:100,300,400,700,900,100italic,300italic,400italic,700italic,900italic" />

    </head>

    <body data-spy="scroll" data-target="#navbar-scroll">

        <!-- /.preloader -->
        <div id="preloader"></div>
        <div id="top"></div>

        <!-- /.parallax full screen background image -->
        <div class="fullscreen landing parallax blog-page" style="background-image:url('images/bg-baner-ariportcity.jpg');" data-img-width="2000" data-img-height="1333" data-diff="100">

            <div class="overlay">
                <div class="container">
                    <div class="col-md-10 col-md-offset-1 text-center">

                        <!-- /.logo -->
                        <div class="logo wow fadeInDown" style="margin-top: 50px">
                             
                        </div>

                        <!-- /.main title -->
                        <h2 class="wow fadeInUp" style="margin-bottom: 50px">
                            Welcome :{{ Dennis }}
                        </h2>

                    </div>
                </div>
            </div>
        </div>

       
            <!-- NAVIGATION -->
            <div id="menu">
                <nav class="navbar-wrapper navbar-default" role="navigation">
                    <div class="container">
                        <div class="navbar-header">
                            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-backyard">
                                <span class="sr-only">Toggle navigation</span>
                                <span class="icon-bar"></span>
                                <span class="icon-bar"></span>
                                <span class="icon-bar"></span>
                            </button>
                            <a class="navbar-brand site-name" href="#top">
                                <span class="wow fadeInLeft" style="display:inline-block"><a href="" class="btn-logo-w"><i class="fa fa-delicious"></i> potomanto</a></span>
                            </a>
                        </div>

                        <div id="navbar-scroll" class="collapse navbar-collapse navbar-backyard navbar-right">
                            <ul class="nav navbar-nav">
                                
                                
                                <li class="ymm-sw">
                                     <a class="dropdown-toggle" data-toggle="dropdown" data-hover="dropdown" data-delay="200" href="/home">Menu <b class="caret"></b> </a>
                                     <ul class="dropdown-menu navbar-nav">
                                        <li><a href="#">My Bookings</a></li>
                                        <li><a href="#">Payments</a></li>
                                        <li><a href="/profile">Profile</a></li> 
                                        <li class="divider"></li>
                                        <li><a href="/logout">Sign out</a></li> 
                                           
                                     </ul>
                                </li>  
                                
                            </ul>
                        </div>
                    </div>
                </nav>
            </div>

         <div id="map-section">
            
                 <div class="row">
                        <div class="col-md-3">
                            <div class="home_booking_control">
                                <form>
                                   
                                
                                        <div class="form-group">
                                            <input class="form-control" name="picking_up" id="picking_up" type="text" placeholder="Picking up" required>
                                        </div> 
                                        <div id="date_time" class="form-group">
                                            <input class="form-control" name="pick_up_date" id="pick_up_date" type="text" placeholder="Pick up date" required>
                                        </div>

                                        <div class="form-group">
                                            <input class="form-control" name="dropping_off" id="dropping_off" type="text" placeholder="Dropping off" required>
                                        </div>

                                        <div class="form-group last">
                                            <input type="button" id="find_direction" class="btn btn-primary" value="REQUEST A DELIVERY">
                                        </div>
                                        
                                        <div id="infoPanel">
                                            <b>Marker status:</b>
                                            <div id="markerStatus"><i>Click and drag the marker.</i></div>
                                            <b>Current position:</b>
                                            <div id="info"></div>
                                            <b>Closest matching address:</b>
                                            <div id="address"></div>
                                          </div>
                            </form>
                            </div>
                        </div>
                        <div class="col-md-9">
                            <div id="map_canvas" class="map_div"></div>
                        </div>
            </div>
        </div>
              


       
            


        <!-- /.javascript files -->
        <script src="js/jquery.js"></script>
        <script src="js/bootstrap.min.js"></script>
        <script src="js/bootstrap-datetimepicker.min.js"></script>
        <script src="js/custom.js"></script>
        <script src="js/jquery.sticky.js"></script>
        <script src="js/wow.min.js"></script>
        <script src="js/owl.carousel.min.js"></script>
        <script src="js/bootstrap-hover-dropdown.js"></script>
        <script src="js/booking.js"></script>
        <script src="js/jquery.validate.min.js"></script> 
        <script>
            new WOW().init();
            

              var map,infoWindow;
              var geocoder;
              var markerA,markerB;
              var inputA, inputB;
              var autocompleteA,autocompleteB;
              var directionsService,directionsDisplay;
             
              
              function initMap() {
                  
                var mapOptions = {
                    center: {lat: 5.5885497, lng: -0.185424},
                    zoom: 5,
                    zoomControl: true,
                    mapTypeControl: false,
                    styles: 'silver' //or 'night'
                };
                
                map = new google.maps.Map(document.getElementById('map_canvas'), mapOptions);
                
                directionsService = new google.maps.DirectionsService();
                directionsDisplay = new google.maps.DirectionsRenderer({
                  draggable: true,
                  map: map
                });
        
                directionsDisplay.addListener('directions_changed', function() {
                  computeTotalDistance(directionsDisplay.getDirections());
                });
                //Define Markers
                markerA = new google.maps.Marker({
                    map: map,
                    label : 'A',
                    draggable: true,
                    title: 'Drag to set Pickup Location'
                  });
                
                markerB = new google.maps.Marker({
                    map: map,
                    label : 'B',
                    draggable: true,
                    title: 'Drag to set drop-off Location'
                  });
                
                inputA= document.getElementById('picking_up');
                inputB= document.getElementById('dropping_off');
                
                var autocompleteA = new google.maps.places.Autocomplete(inputA);
                    autocompleteA.bindTo('bounds', map);

                var autocompleteB = new google.maps.places.Autocomplete(inputB);
                    autocompleteB.bindTo('bounds', map);
                
                google.maps.event.addListener(autocompleteA, 'place_changed', function() {
                    
                    var place = autocompleteA.getPlace();
                    if (!place.geometry) {
                      return;
                    }
                
                    // Set the position of the marker using the place ID and location.
                    markerA.setPlace(/** @type {!google.maps.Place} */ ({
                      placeId: place.place_id,
                      location: place.geometry.location
                    }));
                    markerA.setVisible(true);
                
                });
                
                google.maps.event.addListener(autocompleteB, 'place_changed', function() {
                    
                    var place = autocompleteB.getPlace();
                    if (!place.geometry) {
                      return;
                    }
                
                    // Set the position of the marker using the place ID and location.
                    markerB.setPlace(/** @type {!google.maps.Place} */ ({
                      placeId: place.place_id,
                      location: place.geometry.location
                    }));
                    markerB.setVisible(true);
                    
                    map.setZoom(11);
                    
                    displayRoute(inputA.value,inputB.value);
                });

                infoWindow = new google.maps.InfoWindow;
                
                // auto set location geolocation.
                if (navigator.geolocation) {
                  navigator.geolocation.getCurrentPosition(function(position) {
                    var pos = {
                      lat: position.coords.latitude,
                      lng: position.coords.longitude
                    };
        
                    map.setCenter(pos);
                  }, function() {
                    handleLocationError(true, infoWindow, map.getCenter());
                  });
                } else {
                  // Browser doesn't support Geolocation
                  handleLocationError(false, infoWindow, map.getCenter());
                }
                
                
                   
                 //codeAddress();
              }
              
              function apply_autocomplete(input) {

                    var options = {
                        types: ['geocode']
                    };
                    var autocomplete = new google.maps.places.Autocomplete(input,options);
                    autocomplete.bindTo('bounds', map);
              }
              
              function handleLocationError(browserHasGeolocation, infoWindow, pos) {
                infoWindow.setPosition(pos);
                infoWindow.setContent(browserHasGeolocation ?
                                      'Error: The Geolocation service failed.' :
                                      'Error: Your browser doesn\'t support geolocation.');
                infoWindow.open(map);
              }
              
              
              function displayRoute(origin_add,destination_add)
              {
                  // Set destination, origin and travel mode.
                    var request = {
                      destination: destination_add,
                      origin: origin_add,
                      optimizeWaypoints: true,
                      travelMode: 'DRIVING'
                    };
            
                    // Pass the directions request to the directions service.
                    directionsService.route(request, function(response, status) {
                      if (status == 'OK') {
                        // Display the route on the map.
                        //directionsDisplay.setDirections(response);
                        directionsDisplay.setMap(map);
                        directionsDisplay.setDirections(response);
                        
                        deleteMarkers();
                      }else {
                        console.log('Directions request failed due to ' + status);
                      } 
                    });
              }
              
              function computeTotalDistance(result) {
                var total = 0;
                var myroute = result.routes[0];
                for (var i = 0; i < myroute.legs.length; i++) {
                  total += myroute.legs[i].distance.value;
                }
                total = total / 1000;
                console.log('computeTotalDistance:'+ total + ' km');
              }
              
              function deleteMarkers() {
                markerA.setMap(null);
                markerB.setMap(null);
                //markers = [];
              }
              function codeAddress() 
              {
                geocoder = new google.maps.Geocoder();
              
                var address = 'Accra';
                
                geocoder.geocode( { 'address': address}, function(results, status) {
                if (status == google.maps.GeocoderStatus.OK) {
                  map = new google.maps.Map(document.getElementById('map_canvas'), {
                        zoom: 16,
                        streetViewControl: false,
                        mapTypeControlOptions: {
                        style: google.maps.MapTypeControlStyle.HORIZONTAL_BAR,
                        mapTypeIds:[google.maps.MapTypeId.HYBRID, google.maps.MapTypeId.ROADMAP] 
                },
                center: results[0].geometry.location,
                mapTypeId: google.maps.MapTypeId.ROADMAP
                });
                
                map.setCenter(results[0].geometry.location);
                var markerA = new google.maps.Marker({
                map: map,
                label : 'A',
                position: results[0].geometry.location,
                      draggable: true,
                      title: 'Drag to set Pickup Location'
                });
                
                updateMarkerPosition(results[0].geometry.location);
                  geocodePosition(results[0].geometry.location);
                    
                  // Add dragging event listeners.
                google.maps.event.addListener(markerA, 'dragstart', function() {
                updateMarkerAddress('Dragging...');
              });
                  
              google.maps.event.addListener(markerA, 'drag', function() {
                updateMarkerStatus('Dragging...');
                updateMarkerPosition(markerA.getPosition());
              });
              
              google.maps.event.addListener(markerA, 'dragend', function() {
                updateMarkerStatus('Drag ended');
                geocodePosition(markerA.getPosition());
                  map.panTo(markerA.getPosition()); 
              });
              
              google.maps.event.addListener(map, 'click', function(e) {
                updateMarkerPosition(e.latLng);
                geocodePosition(markerA.getPosition());
                markerA.setPosition(e.latLng);
              map.panTo(markerA.getPosition()); 
              }); 
              
                } else {
                  alert('Geocode was not successful for the following reason: ' + status);
                }
              });
            }
            
            function geocodePosition(pos) {
              geocoder.geocode({
                latLng: pos
              }, function(responses) {
                if (responses && responses.length > 0) {
                  updateMarkerAddress(responses[0].formatted_address);
                } else {
                  updateMarkerAddress('Cannot determine address at this location.');
                }
              });
            }
            
            function updateMarkerStatus(str) {
              document.getElementById('markerStatus').innerHTML = str;
            }
            
            function updateMarkerPosition(latLng) {
              document.getElementById('info').innerHTML = [
                latLng.lat(),
                latLng.lng()
              ].join(', ');
            }
            
            function updateMarkerAddress(str) {
              document.getElementById('picking_up').value = str;
            }
        </script>
        <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyC9H_SZmYKPM0TXnnnHxcRPMJyYjf00rvs&libraries=places&callback=initMap"     async defer></script>
    </body>
</html>